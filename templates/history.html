{% extends "layout.html" %}

{% block title %}Історія завантажень{% endblock %}

{% block content %}
<div class="page-nav">
    <a href="/">← Повернутися до пошуку</a>
</div>

<h1 class="text-left">Історія завантажень</h1>

{% if not history_items %}
    <p>Ваша історія порожня.</p>
{% endif %}

<ul class="history-list">
    {% for item in history_items %}
    {% set material = item.material %}
    <li class="history-item">
        <div class="history-info">
            <a href="{{ material.URL }}" target="_blank" rel="noopener noreferrer">
                {{ material.URL }}
            </a>

            {% if material.Size is not none %}
                <span class="size-info">
                    {{ (material.Size / 1024 / 1024) | round(2) }} MB
                </span>
            {% else %}
                <span class="size-info unknown">
                    Розмір невідомий
                </span>
            {% endif %}
            <p class="date">Дата: {{ item.LoadDate.strftime('%Y-%m-%d %H:%M') }}</p>
        </div>
        
        <div class="actions">
            <form action="/history/delete" method="post"
                  onsubmit="return confirm('Ви впевнені, що хочете видалити цей запис?')">
                <input type="hidden" name="history_id" value="{{ item.HistoryID }}">
                <button type="submit" class="delete-btn">Видалити</button>
            </form>
            {% if material.Type == 'text' %}
                <form action="/convert" method="post">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <button type="submit">Конвертувати в PDF</button>
                </form>
                <span class="tag text">Web-сторінка</span>
            
            {% elif material.Type == 'video' %}
                <form action="/history/track-click" method="post" target="_blank">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <input type="hidden" name="type" value="{{ material.Type }}">
                    <button type="submit" class="link-button">Перейти на YouTube</button>
                </form>
                <span class="tag video">Відео</span>
            {% elif material.Type == 'pdf' %}
                <form action="/history/track-click" method="post" target="_blank">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <input type="hidden" name="type" value="{{ material.Type }}">
                    <button type="submit" class="link-button">Завантажити PDF</button>
                </form>
                <span class="tag pdf">PDF Документ</span>
            {% elif material.Type == 'doc' %}
                <form action="/history/track-click" method="post" target="_blank">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <input type="hidden" name="type" value="{{ material.Type }}">
                    <button type="submit" class="link-button">Завантажити DOC</button>
                </form>
                <span class="tag doc">DOC Документ</span>
            {% elif material.Type == 'ppt' %}
                <form action="/history/track-click" method="post" target="_blank">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <input type="hidden" name="type" value="{{ material.Type }}">
                    <button type="submit" class="link-button">Завантажити PPT</button>
                </form>
                <span class="tag ppt">Презентація</span>
            {% elif material.Type == 'audio_yt_music' %}
                <form action="/history/track-click" method="post" target="_blank">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <input type="hidden" name="type" value="{{ material.Type }}">
                    <button type="submit" class="link-button">Слухати в YouTube Music</button>
                </form>
                <span class="tag audio">Аудіо</span>
            {% elif material.Type == 'audio_spotify' %}
                <form action="/history/track-click" method="post" target="_blank">
                    <input type="hidden" name="url" value="{{ material.URL }}">
                    <input type="hidden" name="type" value="{{ material.Type }}">
                    <button type="submit" class="link-button">Слухати в Spotify</button>
                </form>
                <span class="tag audio">Аудіо</span>
            {% endif %}
        </div>
    </li>
    {% endfor %}
</ul>

{% endblock %}